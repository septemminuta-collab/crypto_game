<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Miner Game</title>
    <!-- –ü–†–ê–í–ò–õ–¨–ù–Ü –°–ö–†–ò–ü–¢–ò SDK -->
    <script src="https://telegram.org"></script>
    <script src="https://sad.adsgram.ai"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #0f0f0f; color: white; text-align: center; padding-top: 50px; margin: 0; }
        .balance-box { background: #1a1a1a; border: 2px solid #00d4ff; border-radius: 20px; padding: 20px; display: inline-block; min-width: 200px; margin-bottom: 30px; box-shadow: 0 0 20px rgba(0, 212, 255, 0.1); }
        #balance { font-size: 48px; color: #00d4ff; font-weight: bold; }
        .btn { background: linear-gradient(45deg, #00d4ff, #0055ff); border: none; color: white; padding: 20px 40px; border-radius: 15px; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3); transition: 0.2s; }
        .btn:active { transform: scale(0.95); opacity: 0.8; }
        .user-info { margin-bottom: 10px; color: #888; font-size: 14px; }
    </style>
</head>
<body>
    <h1>üîã –ï–Ω–µ—Ä–≥–æ-–ú–∞–π–Ω–µ—Ä</h1>
    
    <div class="user-info" id="username">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>

    <div class="balance-box">
        <div id="balance">0</div>
        <p style="margin: 5px 0 0;">–±–∞–ª—ñ–≤</p>
    </div>
    <br>
    <button class="btn" id="adBtn" onclick="showAd()">üì∫ –î–ò–í–ò–¢–ò–°–¨ –†–ï–ö–õ–ê–ú–£ (+100)</button>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
        const user = tg.initDataUnsafe.user;
        if (user) {
            document.getElementById('username').innerText = user.first_name + " (ID: " + user.id + ")";
        }

        // --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ---
        // 1. –í—Å—Ç–∞–≤ —Å–≤–æ—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è –∑ Render (–±–µ–∑ –∫–æ—Å–æ—ó —Ä–∏—Å–∫–∏ –≤ –∫—ñ–Ω—Ü—ñ!)
        const SERVER_URL = "https://traffic-backend-c674.onrender.com"; 
        
        // 2. –í—Å—Ç–∞–≤ —Å–≤—ñ–π Block ID (–∑–∞–ª–∏—à int-4537 –¥–ª—è —Ç–µ—Å—Ç—É)
        const AdController = window.Adsgram.init({ blockId: "int-4537" }); 

        // –§—É–Ω–∫—Ü—ñ—è –ø–æ–∫–∞–∑—É —Ä–µ–∫–ª–∞–º–∏
        async function showAd() {
            const btn = document.getElementById('adBtn');
            btn.disabled = true; // –ë–ª–æ–∫—É—î–º–æ –∫–Ω–æ–ø–∫—É –Ω–∞ —á–∞—Å –∑–∞–ø–∏—Ç—É
            
            try {
                const result = await AdController.show();
                
                if (result.done) {
                    // –Ø–∫—â–æ —Ä–µ–∫–ª–∞–º–∞ –ø–æ–¥–∏–≤–∏–ª–∏—Å—è ‚Äî —à–ª–µ–º–æ –∑–∞–ø–∏—Ç –Ω–∞ Render
                    const response = await fetch(`${SERVER_URL}/reward`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            user_id: user.id,
                            points: 100
                        })
                    });

                    if (response.ok) {
                        // –û–Ω–æ–≤–ª—é—î–º–æ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π –±–∞–ª–∞–Ω—Å
                        let currentBalance = parseInt(document.getElementById('balance').innerText);
                        document.getElementById('balance').innerText = currentBalance + 100;
                        
                        tg.HapticFeedback.notificationOccurred('success');
                        tg.showAlert("–ß—É–¥–æ–≤–æ! +100 –±–∞–ª—ñ–≤ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!");
                    } else {
                        tg.showAlert("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ!");
                    }
                }
            } catch (error) {
                console.error(error);
                tg.showAlert("–†–µ–∫–ª–∞–º–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.");
            } finally {
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
